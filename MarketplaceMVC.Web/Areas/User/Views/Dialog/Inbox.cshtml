@model MarketplaceMVC.Web.Areas.User.Models.Dialog.DialogListViewModel
@{
    ViewBag.Title = "Inbox";
    Layout = "~/Areas/User/Views/Shared/_UserLayout.cshtml";
}


<div class="page-info">
    <h2>Сообщения</h2>
    <p class="lead">Здесь отображается информация по входящим и исходящим сообщениям</p>
</div>
<div class="card-custom-account">
    @{ Html.RenderPartial("_Menu"); }
    @{ Html.RenderPartial("_DialogMenu", Model); }
    <table class="table align-middle" id="dialogs-table">
        <thead>
            <tr>
                <th>@Html.ActionLink("Отправитель", "Inbox", "Message", new { sortOrder = ViewData["NameSortParm"], currentFilter = ViewData["SearchString"] }, null)</th>
                <th>Сообщение</th>
                <th class="date-table">@Html.ActionLink("Дата", "Inbox", "Message", new { sortOrder = ViewData["DateSortParm"], currentFilter = ViewData["SearchString"] }, null)</th>
            </tr>
        </thead>

        @foreach (var dialog in Model.Dialogs)
        {

            var clsBold = "";
            if (dialog.CountOfNewMessages != 0)
            {
                clsBold = "warning-row";
            }

            <tr data-href="@Url.Action("Details","Dialog", new { id = dialog.Id })" id="message-row-@dialog.Id" class="@clsBold">

                <td class="clickable sender-table  position-relative" id="dialog-name" data-id="@dialog.Id">
                    @if (dialog.CountOfNewMessages != 0)
                    {
                        <div class="messagess-count message-count-block-pos" id="dialog-block-counter">
                            @dialog.CountOfNewMessages
                        </div>
                    }

                    <img class="rounded-circle avatar-48 mr-2" src="~/Content/Images/Avatars/@dialog.Companion.Avatar32" alt="Alternate Text" />

                    @dialog.Companion.Name
                </td>
                <td class="clickable" id="dialog-text" data-id="@dialog.Id" style=" max-width: 100px;overflow: hidden;text-overflow: ellipsis; white-space: nowrap; "><span id="message-text" class="wqe" style="">@dialog.Messages.LastOrDefault().MessageBody</span></td>

                <td class="clickable date-table" id="dialog-date" data-id="@dialog.Id" title="@dialog.Messages.LastOrDefault().CreatedDate.ToShortTimeString()">@dialog.Messages.LastOrDefault().CreatedDate.ToShortDateString()</td>
            </tr>

        }
    </table>
</div>

@section scripts
{
    <script>
        $('tr[data-href]').on("click", function () {
            document.location = $(this).data('href');
        });
    </script>

}
